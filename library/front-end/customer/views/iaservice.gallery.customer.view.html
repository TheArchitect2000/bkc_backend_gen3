<!--uses ssbind and sspage tags-->
<style>
    /*comment*/
    /*@import url(//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css);*/

    div.img {
        height: 7pc;
        display: table-cell;
        vertical-align: middle;
    }

    .servicebtn {
        height: 60vw;
    }

    @media (min-width: 768px) {
        .servicebtn {
            max-width: 9pc;
            height: 13.5pc;
        }
    }

    .detailBox {
        /*border:1px solid #bbb;*/
    }

    .titleBox {
        background-color: #fdfdfd;
        padding: 10px;
    }

    .titleBox label {
        color: #444;
        margin: 0;
        display: inline-block;
    }

    .commentBox {
        padding: 10px;
        border-top: 1px dotted #bbb;
    }

    .commentBox .form-group:first-child, .actionBox .form-group:first-child {
        width: 80%;
    }

    .commentBox .form-group:nth-child(2), .actionBox .form-group:nth-child(2) {
        width: 18%;
    }

    .actionBox .form-group * {
        width: 100%;
    }

    .taskDescription {
        color: grey;
        margin-top: 10px;
    }

    .commentList {
        padding: 0;
        list-style: none;
        max-height: 100px;
        overflow: auto;
    }

    .commentList li {
        margin: 0;
        margin-top: 10px;
    }

    .commentList li > div {
        display: table-cell;
    }

    .commenterImage {
        width: 30px;
        margin-right: 5px;
        height: 100%;
        float: left;
    }

    .commenterImage img {
        width: 100%;
        border-radius: 50%;
    }

    .commentText p {
        margin: 0;
    }

    .sub-text {
        color: #aaa;
        font-family: verdana;
        font-size: 11px;
    }

    .actionBox {
        /*border-top: 1px dotted #bbb;*/
        /*padding: 10px;*/
    }

    div.service {
        text-align: left;
        min-height: 15pc;
    }

    .service-name {
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
<style>
    .topnav {
        overflow: hidden;
        white-space: nowrap;
    }

    .topnav a {
        color: grey;
        /*float: left;*/
        display: inline-block;
        /*color: #f2f2f2;*/
        text-align: center;
        /*padding: 14px 16px;*/
        text-decoration: none;
        /*font-size: 17px;*/
    }

    /*.active {
        !*background-color: #4CAF50;*!
        color: white;
    }*/

    .topnav .icon {
        display: none;
    }

    /*.dropdown {
        float: left;
        !*overflow: hidden;*!
    }

    .dropdown .dropbtn {
        font-size: 17px;
        border: none;
        outline: none;
        color: white;
        padding: 14px 16px;
        background-color: inherit;
        font-family: inherit;
        margin: 0;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        !*box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);*!
        z-index: 1;
    }

    .dropdown-content a {
        float: none;
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
    }

    .topnav a:hover, .dropdown:hover .dropbtn {
        !*background-color: #555;*!
        !*color: white;*!
    }

    .dropdown-content a:hover {
        background-color: #ddd;
        color: black;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }*/

    @media screen and (max-width: 600px) {
        .topnav a:not(:first-child), .dropdown .dropbtn {
            display: none;
        }

        .topnav a.icon {
            float: right;
            display: block;
        }

        ul.logs li .logdate {
            float: none !important;
        }

        ul.logs li .logstate {
            text-align: left !important;
        }
    }

    @media screen and (max-width: 600px) {
        .topnav.responsive {
            position: relative;
        }

        .topnav.responsive .icon {
            position: absolute;
            right: 20px;
            top: 20px;
        }

        .topnav.responsive a {
            float: none;
            display: block;
            text-align: left;
        }

        /*.topnav.responsive .dropdown {
            float: none;
        }

        .topnav.responsive .dropdown-content {
            position: relative;
        }

        .topnav.responsive .dropdown .dropbtn {
            display: block;
            width: 100%;
            text-align: left;
        }*/
    }

    #filter_name {
        background-color: transparent; text-indent: 1.6pc; width: 30vw;margin-bottom: 4px
    }

    @media (max-width: 600px) {
        .filterbar {
            position: relative !important;
        }

        .filterbar .params{
            float: none !important;
        }

        #filter_name {
            width: 80vw;
        }
    }

    .filterbar .params{
        float: right;
    }

    .filterbar label {
        /*border: 1px solid #ddd;*/
        font-weight: bold;
        /*height: 30px;*/
        /*padding: 2px 5px 2px 10px;*/
        /*border-radius: 3px;*/
        /*text-align: left;*/
        /*font-weight: normal;*/
    }

    .filterbar input, .filterbar select {
        border-radius: 3px;
        border: 1px solid #ddd;
        /* background-color: #EEEEEE; */
        font-weight: bold;
        height: 30px;
        padding: 2px 5px 2px 5px;
        /*width: 150px;*/
        /*margin-bottom: 2px;*/
    }


    /* HIDE RADIO */
    /*[type=radio] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }*/

    /* IMAGE STYLES */
    /*label {
        cursor: pointer;
    }*/

    /*[type=radio] + div {
        !*box-shadow: 0 0 1px 5px #d5dae0;*!
        !*text-shadow: 1px 1px 4px #000000;*!
        -webkit-box-shadow: 2px 2px 5px 0px rgba(94, 92, 96, 0.77);
        -moz-box-shadow: 2px 2px 5px 0px rgba(94, 92, 96, 0.77);
        box-shadow: 2px 2px 5px 0px rgba(94, 92, 96, 0.77);
    }

    [type=radio]:disabled + div {
        -webkit-box-shadow: 0;
        -moz-box-shadow: 0;
        box-shadow: 0px 0px 0px 0px rgba(255, 255, 255, 0.75);
        !*background-color: rgba(0, 0, 0, 0.2) !important;*!
        color: #bbbbbb;
    }*/

    /* CHECKED STYLES */
    [type=radio]:checked + div {
        box-shadow: 0 0 1px 5px #d42021;
    }
</style>
<script src="../../resources/plugins/jqcron/jqCron.js"></script>
<script src="../../resources/plugins/jqcron/jqCron.en.js"></script>
<link rel="stylesheet" href="../../resources/plugins/jqcron/jqCron.css">
<script>

    function installService(serviceId, version) {
//        submit new installedservice

        var newinstalledservice = {
            ServiceId: serviceId,
            ServiceVersion: version,
            Vars: $('#varsform').serializeArray(),
            Devices: $('#devicesform').serializeArray(),
            Cron: (services[SelectedIndex].Cron) ? $('#croninput').val() : false,
            Activated: true
        };
        $('.modal').click();
        $.post('/installedservice', newinstalledservice, function (addedinstalledservice) {


            $('.modal-backdrop').hide();
            $('body').removeClass('modal-open');
            updateServices(function () {
                show_sspage("../customer/views/installedservice.customer.list.view.html");
                //refresh iabt pan:
                show_sspage('/customer/views/iabt.pan.view.html',null,'#iabtpan');
                swal.fire("Service is installed!", "Service \"" + services[SelectedIndex].Name + "\" is installed successfully.", "success", {closeOnClickOutside: true});
            });


        }).fail(function (response) {
            swal.fire("Error", response.responseJSON ? response.responseJSON.message : '', "error", {closeOnClickOutside: false});
            console.error(response.responseText)
        });
    }

    function getStars(s) {
        var stars = '';
        for (var i = 1; i <= 5; i++) {
            if (i < s)
                stars += '<i class="mdi mdi-star col-blue"></i>';
            else
                stars += '<i class="mdi mdi-star-outline col-grey"></i>';
        }
        return stars;
    }

    function renderInputdevices() {
        var h = "<form id='devicesform'><div class='row'>"
        for (var inp in services[SelectedIndex].Devices) {
            var input = services[SelectedIndex].Devices[inp];
            h += "<div class='col-sm-6 col-xs-12'>"
            h += input.Title || input.Name;
            h += ' <small class="col-grey">'+input.DeviceType+'</small>';

            let allDevs = [...home._devices];

            h += ' <select class="form-control" name="' + input.Name + '" onfocus="if(this.value===\'_SHAREDDEVICE_\') this.selectedIndex = -1;" onchange="if(this.value===\'_SHAREDDEVICE_\') showSharedDevices(this,\''+ input.Name +'\',\''+input.DeviceType+'\');">';
            // let allDevs = [...home._devices,...sharedDevices];

            for (var aDevice of allDevs) {//todo add shared devices to this array
                if (input.DeviceType === aDevice.DeviceType) {
                    var cls = '';
                    var txt = aDevice.Name;
                    //if device is shared and is not for this home (has not MAC)
                    //todo change this to new approach to shared device lookup window
                    if(aDevice.Share && aDevice.Share.Tokens && !aDevice.hasOwnProperty('MAC')){
                        if(!input.TransferTo){
                            //prevent to show this device if this input device could not give token or input.TransferTo is false
                            continue;
                        }
                        cls = 'col-blue';
                        txt += ' (Shared for '+ aDevice.Share.Tokens +' BKC)';
                    }
                    h += "<option class='" + cls + "' value='" + aDevice._id + "'>" + txt + "</option>";
                }
            }
            //add shared link
            h += "<option class='col-blue bg-silver' value='_SHAREDDEVICE_'>Open Shared Devices Map ...</option>";

            h += '</select></div>';
        }
        h += "</div></form>"
        $(".inputdevices").html(h)
    }

    function renderInputvars() {
        var getlocation = false;
        var h = "<form id='varsform'><div class='row'>"
        for (var v in services[SelectedIndex].Vars) {
            var variable = services[SelectedIndex].Vars[v];
            h += "<div class='col-sm-6 col-xs-12'>"
            h += variable.Title || variable.Name;
            h += ' <input class="form-control" name="' + variable.Name + '" type="' + variable.Type + '">';
            h += '</div>';
            //latitude longitude todo bad detect name, change to variable.type
            if(['latitude','longitude'].includes(variable.Name.toLowerCase()))
                getlocation = true;
        }

        h += "</div></form>"
        $(".inputvars").html(h);

        //latitude longitude
        if(getlocation){
            var geobutton = $("<button class='btn btn-info'>Get My Location</button>");
            geobutton.click(function (){
                getBrowserLocation(({lat, lon})=>{
                    $( "input[name*='latitude' i]").val(lat);
                    $( "input[name*='longitude' i]").val(lon);
                });
            })
            $(".inputvars").append(geobutton);
        }
    }

    function renderCrontabs() {
        $('.crondiv').html('').jqCron({
               enabled_minute: true,
               multiple_dom: true,
               multiple_month: true,
               multiple_mins: true,
               multiple_dow: true,
               multiple_time_hours: true,
               multiple_time_minutes: true,
//                default_period: 'week',
            default_value: '30 7 */3 * *',
            bind_to: $('#croninput'),
//                bind_method: {
//                    set: function($element, value) {
//                        $element.val(value);
//                    }
//                },
            no_reset_button: false,
            lang: 'en'
        });
    }

    function isCompatible(_service) {
        if(! _service.Devices || _service.Devices.length ===0){
            return true;
        }

        if(! home._devices || home._devices.length ===0){
            return false;
        }

        return _service.Devices.filter(sd=>home._devices.filter(hd=>hd.DeviceType===sd.DeviceType).length===0).length === 0;
    }

    function filter_compatible(services) {
        var r = services;
        var _compatible = document.querySelector('#filter_compatible').checked;
        if(_compatible) {
            r = services.filter(s => s.Compatible === _compatible);
        }
        return r;
    }

    function filter_name(services) {
        var r = services;
        if($('#filter_name').val().trim()!=='') {
            r = services.filter(s => s.Name.toLowerCase().indexOf($('#filter_name').val().toLowerCase())>-1);
        }
        return r;
    }

    function showThese(_someservices) {
        $('.servicebtn').hide();
        for(var s of _someservices){
            $('[serviceid='+s._id+']').show();
        }
    }

    var filteredServices = [];
    function filterServices() {
        filteredServices = filter_compatible(services);
        filteredServices = filter_name(filteredServices);
        showThese(filteredServices);
    }

    var serviceId = (new URLSearchParams(localStorage.getItem("sspage").split('?')[1])).get('serviceId');

    var services = [];
    var directService = false;
    var _url = '/iaservice/gallery/';//get all published services
    if(serviceId){//show just this service to direct install
        _url = '/iaservice/'+serviceId;
        directService = true;
    }

    $.getJSON(_url, function (data) {
        services = data;

        if(directService){
            data.PublishedVersion= 0;
            services = [data];
        }

        for(var ser of services){
            ser.Compatible = isCompatible(ser);
            /*Object.assign(ser, ser.Publish.Releases[0].Snapshot);
            delete ser.Publish.Releases[0].Snapshot;
            Object.assign(ser, ser.Publish.Releases[0]);
            delete ser.Publish.Releases;
            Object.assign(ser, ser.Publish);
            delete ser.Publish;*/
        }

        services.sort(s=>(s.Published || s.PublishedVersion) ? -1 : 1);
        services.sort(s=>(s.Copyright==="IA Recommend")?-1:1 );

        ssbindRender();
        //        ssbindRenderLevel('lev00');
    });



    var SelectedIndex = -1;
    var serviceId = -1;
    var version = -1;
    var ServiceComments = [];

    //activate select buttons
    setTimeout(function () {
        $('.services').off().on('click', '.servicebtn', '', function () {
            SelectedIndex = $(this).attr('SelectedIndex');
            serviceId = $(this).attr('ServiceId');
            version = $(this).attr('Version');
            console.log('call service select dialog', serviceId, version);
            ssbindRenderLevel('selectService');
            renderInputdevices();
            renderInputvars();
            renderCrontabs();
            ServiceComments = [];
            $.get('/iaservice/comments/'+serviceId , function (comments) {
                ServiceComments = comments;
                ssbindRenderLevel('servicecomments');
            });
            $('.addService').off().on('click', function () {
                $('.c1').hide(500);
                $('.c2').show(400);
            });
            $('.addServiceBack').off().on('click', function () {
                $('.c2').hide(500);
                $('.c1').show(400);
            });
            $('.addServiceActivate').off().on('click', function () {
                installService(serviceId, version);
            })
        })
    }, 500);

    $('#filter_compatible').change(()=>{filterServices()});
    $('#filter_name').keyup(()=>{filterServices()});

    /*
     var delay = (function () {
     var timer = 0;
     return function (callback, ms) {
     clearTimeout(timer);
     timer = setTimeout(callback, ms);
     };
     })();


     $.fn.extend({
     animateCss: function (animationName) {
     var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
     $(this).addClass('animated ' + animationName).one(animationEnd, function () {
     $(this).removeClass('animated ' + animationName);
     });
     }
     });*/
</script>

<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="card" style="min-height: 80vh">
        <div class="header topnav filterbar align-left" id="myTopnav">
            <span class="ia-head">
                <!--<i class="icon2 Icon-newservice"></i>-->
                <span class="icon2 service-gallery-icon"></span>
                Service Market
            </span>
            <a href="javascript:void(0);" class="header-dropdown icon mdi mdi-filter font-20" onclick="dropdownmenu()"></a>
            <span class="params">
                <!--<span class="col-grey m-r-20 m-l-20 hidden-xs">&nbsp;&nbsp;&nbsp;&nbsp;</span>-->
                <!--<a class="">
                    <i class="mdi mdi-sort-variant" style="font-size: 15px"></i>
                    <label class="col-grey ">Sort</label>
                    <select id="topsort">
                        <option value="LASTACTIVITY">Last Activity</option>
                        <option value="DEVICENAME">Device Name</option>
                        <option value="DEVICESTATE">Device State</option>
                    </select>
                </a>-->
                <span class="col-grey m-r-20 m-l-20 hidden-xs"> </span>
                <a class="">
                    <i class="mdi mdi-magnify m-r--25" style="font-size: 17px"></i>
                    <input id="filter_name" placeholder="Search" type="search">
                </a>
                <span class="col-grey m-r-10  hidden-xs"> </span>
                <a class="">
                    <!--<i class="mdi mdi-gamepad-circle" style="font-size: 15px"></i>-->
                    <!--<label class="col-grey">Filter</label>-->

                    <input class="chk-col-red filled-in btn" type="checkbox" id="filter_compatible">
                    <label for="filter_compatible" title="Show only compatible services with my home devices">
                        Compatible with my home devices
                    </label>
                </a>

                <!--&#9776;-->

            </span>
        </div>
        <div class="body">
            <div class="">



                <div class=" row services">

                    <!--Each Service-->
                    <tag ssfor="services">
                        <span ssif="ssIndex == 0" class="col-sm-12 col-xs-12 ia-big-title col-red font-bold">Recommended Services</span>
                        <span ssif="ssIndex > 0 && services[ssIndex-1].Copyright==='IA Recommend' && services[ssIndex].Copyright!=='IA Recommend'" class="col-sm-12 col-xs-12 ia-big-title col-red font-bold">Last Released</span>
                        <!--<span ssif="ssIndex > 0 && (services[ssIndex-1].Published || (services[ssIndex].Publish && services[ssIndex].PublishedVersion)) && !(services[ssIndex].Published || (services[ssIndex].Publish && services[ssIndex].PublishedVersion))" class="col-sm-12 col-xs-12 ia-big-title col-red">My not published Services</span>-->

                        <label  data-toggle="modal" data-target="#defaultModal"
                           ssbind="ServiceId:services[ssIndex]._id ; Version:services[ssIndex].PublishedVersion||0  ; SelectedIndex:ssIndex"
                           class="btn btn-link servicebtn col-sm-2 col-lg-2 col-md-2 col-xs-6  hover-zoom-effect ">

                        <div class="service font-thin">
                            <span
                                  ssbind="class:services[ssIndex].Compatible ?'homecompatible mdi mdi-gamepad-circle font-20 col-grey':'homecompatible mdi mdi-gamepad-circle-left font-20 col-grey' ; title:services[ssIndex].Compatible ? 'Compatible with your IoT devices' : 'Is not compatible with your IoT devices'"></span>
                            <span ssif="services[ssIndex].Cron" class="mdi mdi-timetable font-20 col-grey"></span>
                            <!--services[ssIndex].color +-->
                            <div class="img">
                                <img class="img-responsive" onerror="this.src = defaulticon"
                                     ssbind="src: '/iaservice/icon/'+services[ssIndex]._id ; class: services[ssIndex].Iconpadding?'img-responsive iconpadding ':'img-responsive' ">
                            </div>
                            <div class=" ia-medium-title text-capitalize service-name font-10"
                                 ssbind="text:services[ssIndex].Name;title:services[ssIndex].Name">
                            </div>
                            <div class="developer text-capitalize col-grey font-10">
                                Version: <span class="" ssbind="text:services[ssIndex].PublishedVersion"></span>
                            </div>
                            <div>
                            <div class="developer text-capitalize col-grey font-10"
                                 ssbind="text:'By: '+services[ssIndex]._Developer"></div>
                            <div>
                                <span class=" font-10"
                                      ssbind="html: getStars(services[ssIndex].Stars)">
                                </span>
                            </div>
                        </div>
                        </div>
                    </label>
                    </tag>
                </div>
            </div>
        </div>
    </div>

    <!--Modal Dialog-->
    <div class="modal fade in" id="defaultModal" tabindex="-1" role="dialog" style="display: none;">
        <div class="modal-dialog m-t-100" role="document">
            <div class="modal-content ">
                <div class="modal-body">
                    <div class="card service hover-zoom-effect container-fluid ">
                        <!--<input type="radio" name="servicetype"
                               sslevel="selectService" ssbind="value:services[SelectedIndex] ; disabled:!services[SelectedIndex].Active">-->
                        <div class="row">
                            <!--service name and developer-->
                            <div class="col-sm-8 col-xs-12">
                                <img style="max-width: 150px; max-height: 150px; margin-top: -90px; background-color: white;-webkit-box-shadow: 5px 4px 9px -1px rgba(0,0,0,0.51);
box-shadow: 5px 4px 9px -1px rgba(0,0,0,0.51);" sslevel="selectService"
                                     onerror="this.src = defaulticon"
                                     ssbind="src: '/iaservice/icon/'+services[SelectedIndex]._id ; class: services[SelectedIndex].Iconpadding?'img-responsive iconpadding ':'img-responsive' ">
                                <br>
                                <b class=" ia-bigger-title text-capitalize"
                                   sslevel="selectService" ssbind="text:services[SelectedIndex].Name">
                                </b>
                                <br>
                                <span class="text-capitalize col-grey c1 align-left float-right">
                                    Version
                                    <span class="badge" sslevel="selectService" ssbind="text:services[SelectedIndex].Version||0"></span>
                                    <span sslevel="selectService" ssbind="text:moment(services[SelectedIndex].PublishTime).format('MMM DD')"></span><br>
                                </span>
                                <span class=" text-capitalize col-grey c1"
                                      sslevel="selectService" ssbind="html:services[SelectedIndex]._Developer || '<i>Set your developer alias</i>'">
                                </span>

                            </div>
                            <!--Installed and Rate-->
                            <div class="col-sm-4 col-xs-12 text-center c1">
                                <small class="col-grey">Installed by</small>
                                <br>
                                <span class=" text-capitalize ia-bigger-title"
                                      sslevel="selectService" ssbind="text:services[SelectedIndex]._Installed || 0">
                                </span>
                                <br>
                                <span class=" font-20"
                                      sslevel="selectService" ssbind="html: getStars(services[SelectedIndex]._Stars)">
                                </span>
                            </div>
                        </div>
                        <!--Prices and Install Button-->
                        <div class="row c1 p-t-15">
                            <div class=" col-sm-4 col-xs-6">
                                <small class="col-grey"><nobr>Installation Price <b>(BKC)</b></nobr></small>
                                <div class=" ia-bigger-title col-green"
                                     sslevel="selectService" ssbind="text:services[SelectedIndex].Price.Add==0?'Free':services[SelectedIndex].Price.Add">
                                </div>
                            </div>
                            <div class=" col-sm-1 col-xs-0 "></div>
                            <div class=" col-sm-3 col-xs-6 ">
                                <small class="col-grey"><nobr>Running Price <b>(BKC)</b></nobr></small>
                                <div class=" ia-bigger-title col-green"
                                     sslevel="selectService" ssbind="text:services[SelectedIndex].Price.Run==0?'Free':services[SelectedIndex].Price.Run">
                                </div>
                            </div>
                            <div class=" col-sm-4 col-xs-12 p-t-10 text-right">
                                <button style="width: 100%" type="button"
                                        class="btn ia-big-title btn-primary-ia waves-effect addService ">
                                    Install
                                </button>
                            </div>
                        </div>
                        <!--tabs-->
                        <div class="row c1 ">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs nav-justified tab-nav-right tab-col-red" style="border-bottom:1px solid #CCCCCC" role="tablist">
                                <li role="presentation" class="ia-medium-title  active"><a href="#description"
                                                                                           data-toggle="tab"
                                                                                           class="p-b-0"
                                                                                           aria-expanded="true">Description</a>
                                </li>
                                <li role="presentation" class="ia-medium-title "><a href="#spec" data-toggle="tab"
                                                                                    class="p-b-0"
                                                                                    aria-expanded="false">Specification</a>
                                </li>
                                <li role="presentation" class="ia-medium-title "><a href="#comment" data-toggle="tab"
                                                                                    class="p-b-0"
                                                                                    aria-expanded="false">Comments</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane fade active in" id="description"
                                     sslevel="selectService" ssbind="text:services[SelectedIndex].Description">

                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="spec">
                                    <div class=" col-sm-6 col-xs-12">
                                        <small class="col-grey">Compatibility :</small>
                                        <div class=" text-capitalize"
                                             sslevel="selectService"
                                             ssbind="text:services[SelectedIndex].Devices ? services[SelectedIndex].Devices.map(dev=>' '+dev.DeviceType) : '--'">
                                        </div>
                                    </div>

                                    <div class=" col-sm-6 col-xs-12">
                                        <small class="col-grey">Need Access To :</small>
                                        <ul class=" col-blue m-l--40"
                                            sslevel="selectService"
                                            ssbind="text:services[SelectedIndex].NeedAccesses ? services[SelectedIndex].NeedAccesses.join('\n') : ''">
                                        </ul>
                                    </div>

                                    <div class=" col-sm-6 col-xs-12">
                                        <small class="col-grey">Category :</small>
                                        <div class="service-category text-capitalize"
                                             sslevel="selectService" ssbind="text:services[SelectedIndex].Category">
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="comment">
                                    <div class="detailBox">
                                        <!--<div class="titleBox">
                                            <label>User Comments</label>
                                            <button type="button" class="close" aria-hidden="true">&times;</button>
                                        </div>-->
                                        <!--<div class="commentBox">

                                            <small class="taskDescription">Please add your experience of this service
                                            </small>
                                        </div>-->
                                        <div class="actionBox">
                                            <ul class="commentList">
                                                <li ssfor="ServiceComments with cId cObj" sslevel="servicecomments" ssemptylist="Yet no Comment">
                                                    <div class="commenterImage">
                                                        <!--<img src="https://placekitten.com/50/50"/>-->
                                                    </div>
                                                    <div class="commentText">
                                                        <p class="" sslevel="servicecomments" ssbind="text:ServiceComments[cId].Text">Hello this is a test comment.</p> <span
                                                            class="date sub-text" sslevel="servicecomments" ssbind="text:ServiceComments[cId].createdAt"></span>
                                                    </div>
                                                </li>
                                            </ul>
                                            <!--<div class="form-inline" role="form">
                                                <div class="form-group">
                                                    <input class="form-control" type="text"
                                                           placeholder="Your comments"/>
                                                </div>
                                                <div class="form-group">
                                                    <button class="btn btn-default">Add</button>
                                                </div>
                                            </div>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--configs-->
                        <div class="row c2 collapse body">
                            <div ssif="services[SelectedIndex].Devices && services[SelectedIndex].Devices.length > 0" sslevel="selectService">
                                <small class="ia-medium-title col-red">Config Devices</small>
                                <br>
                                <small class="col-grey">Choose a device in the bellow box(s):</small>
                                <div class="inputdevices p-t-15"></div>
                            </div>
                            <div ssif="services[SelectedIndex].Vars && services[SelectedIndex].Vars.length > 0" sslevel="selectService">
                                <small class="ia-medium-title col-red">Set Variables</small>
                                <br>
                                <small class="col-grey">Specify appropriate value(s) in the bellow box(s):</small>

                                <div class="inputvars p-t-15"></div>
                            </div>
                            <div ssif="services[SelectedIndex].Cron" sslevel="selectService">
                                <small class="ia-medium-title col-blue"><span class="mdi mdi-timetable font-20 col-blue"></span>Schedule Time</small>
                                <br>
                                <div class="crondiv"></div>
                                <input type="hidden" id="croninput">
                            </div>
                            <div class="text-right">
                                <button type="button"
                                        class="btn btn-link ia-big-title waves-effect addServiceBack col-red ">Back
                                </button>
                                <button type="button"
                                        class="btn ia-big-title btn-primary-ia waves-effect addServiceActivate ">
                                    Activate
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<tag sspage-load="/dialogs/map-shared-devices.html" sspage-cacheXXX sspage-load-pre="."></tag>
<script>
    $('#defaultModal').off().on('hidden.bs.modal', function () {
        $('.c2').hide();
        $('.c1').show();
    });
    function dropdownmenu() {
        /*var x = document.getElementById("myTopnav");
         if (x.className === "topnav") {
         x.className += " responsive";
         } else {
         x.className = "topnav";
         }*/
        $('#myTopnav').toggleClass('responsive');
        $('#myTopnav .icon').toggleClass('mdi-filter mdi-close');

    }
</script>
